<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Annielytics Model Picker for AI Projects</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Favicon -->
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/favicon.png') }}">

    <!-- CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Load the vis-network CSS from unpkg -->
    <link rel="stylesheet" href="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

    <!-- Initialize network data -->
    <script>
        window.networkData = {% if network_data %}{{ network_data | safe }}{% else %}null{% endif %};
    </script>
</head>
<body>
    <div class="container-fluid"> 
        <!-- Header Container -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="header-title">Model Picker for AI Projects</h1>
            <img src="{{ url_for('static', filename='img/annielytics-logo.png') }}" alt="Annielytics Logo" class="header-logo">
        </div>

        <!-- Model Picker Form -->
        <form id="modelPickerForm">
            <section class="form-section">
                <!-- Tasks -->
                <h3>What tasks will your AI app perform? <span class="info-icon" data-tooltip="You can select more than one task. If there's a task you'd like to suggest, please fill out the form below.">ⓘ</span></h3>
                <div class="checkbox-group">
                    <label class="checkbox-option">
                        <input type="checkbox" name="tasks" value="chain_agents">
                        <span class="checkbox-text">Chain agents</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="tasks" value="chat">
                        <span class="checkbox-text">Chat</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="tasks" value="stt">
                        <span class="checkbox-text">Convert speech to text</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="tasks" value="tts">
                        <span class="checkbox-text">Convert text to speech</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="tasks" value="generate_code">
                        <span class="checkbox-text">Generate code</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="tasks" value="generate_images">
                        <span class="checkbox-text">Generate images</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="tasks" value="generate_text">
                        <span class="checkbox-text">Generate text</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="tasks" value="generate_video">
                        <span class="checkbox-text">Generate video</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="tasks" value="solve_complex_problems">
                        <span class="checkbox-text">Solve complex problems</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="tasks" value="solve_math_problems">
                        <span class="checkbox-text">Solve math problems</span>
                    </label>
                </div>
            </section>

            <!-- Goals Section -->
            <section id="goalsSection" class="form-section">
                <h3>What benchmarks do you want to compare?</h3>
                <div class="checkbox-group">
                    <label class="checkbox-option">
                        <input type="checkbox" name="goals" value="quality">
                        <span class="checkbox-text">Quality</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="goals" value="cost">
                        <span class="checkbox-text">Cost</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="goals" value="speed">
                        <span class="checkbox-text">Speed</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="goals" value="latency">
                        <span class="checkbox-text">Latency</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="goals" value="context_window">
                        <span class="checkbox-text">Context window</span>
                    </label>
                </div>
            </section>

            <button type="submit" class="submit-button">Compare models</button>
        </form>
    </div>

    <!-- Results Container -->
    <div id="results" class="results-container hidden">
        <!-- Slider Container -->
        <div class="slider-container">
            <label for="node-spacing-slider" class="d-block">Set zoom level:</label>
            <div class="slider-with-signs">
                <div class="signs-container">
                    <span class="zoom-sign minus">−</span>
                    <span class="zoom-sign plus">+</span>
                </div>
                <input type="range" id="node-spacing-slider" min="100" max="1000" value="200" step="50">
            </div>
        </div>

        <!-- Network Graph Section -->
        <h2>Model Strategy <span class="info-icon" data-tooltip="...long tooltip text...">ⓘ</span></h2>

        <!-- Network Container -->
        <div id="network-container" class="w-full h-96 border rounded-lg bg-white shadow-sm">
            {{ graph_body | safe }}
        </div>

        <!-- React Component Container -->
        <div id="card-root"></div>

        <!-- Load dependencies in correct order -->

        <!-- 1. jQuery -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <!-- 2. vis-network JavaScript -->
        <script src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>

        <!-- 3. Check if vis is loaded -->
        <script>
            console.log('After loading vis-network, vis is:', typeof vis);
        </script>

        <!-- 4. Your network.js (which uses vis) -->
        <script src="{{ url_for('static', filename='js/network.js') }}"></script>

        <!-- 5. React and Babel -->
        <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
        <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

        <!-- 6. Your React component code -->
        {% raw %}
        <script type="text/babel">
            const LeaderboardModal = () => {
                const [leaderboardData, setLeaderboardData] = React.useState(null);
                const [showModal, setShowModal] = React.useState(false);

                React.useEffect(() => {
                    const handleLeaderboardClick = async (event) => {
                        try {
                            const response = await fetch('/filter_data', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ node_id: event.detail.nodeId })
                            });
                            const data = await response.json();
                            setLeaderboardData(data);
                            setShowModal(true);
                        } catch (error) {
                            console.error('Error fetching leaderboard data:', error);
                        }
                    };

                    window.addEventListener('leaderboardClick', handleLeaderboardClick);
                    return () => window.removeEventListener('leaderboardClick', handleLeaderboardClick);
                }, []);

                if (!leaderboardData) return null;

                const closeModal = () => {
                    setShowModal(false);
                };

                return (
                    <div>
                        {/* Bootstrap Modal Structure */}
                        {showModal && (
                            <div className="modal d-block" style={{ backgroundColor: 'rgba(0,0,0,0.5)' }}>
                                <div className="modal-dialog modal-lg">
                                    <div className="modal-content">
                                        <div className="modal-header">
                                            <h5 className="modal-title">
                                                {leaderboardData.leaderboard}
                                            </h5>
                                            <button type="button" className="close" onClick={closeModal}>
                                                <span>&times;</span>
                                            </button>
                                        </div>
                                        <div className="modal-body">
                                            <div className="row">
                                                {/* Left Column */}
                                                <div className="col-md-6 mb-3">
                                                    <a
                                                        href={leaderboardData.source}
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                        className="text-blue-600 hover:text-blue-800"
                                                    >
                                                        Visit Leaderboard ↗
                                                    </a>
                                                    <p className="mt-3">{leaderboardData.tooltip}</p>
                                                    {leaderboardData.methodology && (
                                                        <a
                                                            href={leaderboardData.methodology}
                                                            target="_blank"
                                                            rel="noopener noreferrer"
                                                            className="text-blue-600 hover:text-blue-800"
                                                        >
                                                            View Methodology ↗
                                                        </a>
                                                    )}
                                                </div>

                                                {/* Right Column */}
                                                <div className="col-md-6">
                                                    <h5>Tips for using this leaderboard</h5>
                                                    <ul className="list-unstyled mt-3">
                                                        {leaderboardData.analysis_tips?.map((tip, index) => (
                                                            <li key={index} className="mb-2">
                                                                • {tip}
                                                            </li>
                                                        ))}
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="modal-footer">
                                            <button type="button" className="btn btn-secondary" onClick={closeModal}>
                                                Close
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            document.addEventListener('DOMContentLoaded', () => {
                const container = document.getElementById('card-root');
                const root = ReactDOM.createRoot(container);
                root.render(<LeaderboardModal />);
            });
        </script>
        {% endraw %}

    <!-- Submit form -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('modelPickerForm');
            const resultsContainer = document.getElementById('results');
    
            // If the URL has parameters, show results and initialize the network
            if (window.location.search) {
                resultsContainer.classList.remove('hidden');
                initializeNetwork();
            }
    
            form.addEventListener('submit', function() {
                resultsContainer.classList.remove('hidden');
                // Slight delay to ensure UI updates before initializing
                setTimeout(initializeNetwork, 100);
            });
        });
    </script>      
</body>
</html>
